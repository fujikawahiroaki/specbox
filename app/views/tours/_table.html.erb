<table class="text-sm min-w-full table-auto border-collapse">
  <thead>
    <tr class="bg-gray-100">
      <% visible_columns.each do |col| %>
        <% sort_col = col == "formatted_created_at" ? "created_at" : col %>
        <th class="px-4 py-2 border border-gray-300 text-left">
          <%= link_to tours_path(sort: sort_col, direction: toggle_direction(sort_col)),
            data: {
              controller: "tooltip",
              action: "mouseover->tooltip#show mouseout->tooltip#hide",
              turbo_frame: "content-zone",
            }, 
            class: "font-bold text-blue-600 flex items-center" do %>
            <%= { "title" => "タイトル", "start_date" => "開始日", "end_date" => "終了日", "formatted_created_at" => "更新日時", "note" => "備考" }[col] %>
            <%= sort_icon(sort_col) %>
            <!-- ツールチップ -->
            <span data-tooltip-target="tooltip"
                  class="absolute hidden bg-gray-800 text-white text-xs rounded p-1 z-50 pointer-events-none">
              列クリックで並べ替え
            </span>
          <% end %>
        </th>
      <% end %>
      <th class="px-4 py-2 border border-gray-300 text-left">操作</th>
    </tr>
  </thead>
  <tbody>
    <% tours.each do |tour| %>
      <tr id="tour_<%= tour.id %>" class="hover:bg-gray-100">
        <!-- turbo_stream_from で削除対象の行を監視 -->
        <%= turbo_stream_from "tour_#{tour.id}" %>

        <% visible_columns.each do |col| %>
          <td class="px-4 py-2 border border-gray-300"><%= tour.send(col) %></td>
        <% end %>
        <td class="px-4 py-2 border border-gray-300">
          <div class="flex gap-3 mt-2 flex-col sm:flex-row">
            <!-- 詳細リンク (ページ遷移) -->
            <%= link_to "詳細", tour, class: "rounded-lg py-1 px-3 bg-gray-100 text-sm font-medium",
              data: { turbo_frame: "content-zone", turbo_action: "advance" } %>

            <!-- 編集リンク (ページ遷移) -->
            <%= link_to "編集", edit_tour_path(tour), class: "rounded-lg py-1 px-3 bg-gray-100 text-sm font-medium",
              data: { turbo_frame: "content-zone", turbo_action: "advance" } %>

            <!-- 削除リンク (Turbo Stream で削除) -->
            <%= link_to "削除", tour_path(tour), method: :delete, class: "rounded-lg py-1 px-3 bg-red-500 text-white text-sm font-medium",
              data: { turbo_confirm: "本当に削除しますか?", turbo_method: :delete, turbo_stream: "tour_#{tour.id}" } %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
